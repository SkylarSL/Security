#!/bin/bash

echo "logging in as alice and saving cookie"

echo "login as alice" > "response.txt"
curl -vs -c "cookie-jar.txt" -d "username=alice&password=easypasswd&form=login" -X POST "$1/post.php" >> "response.txt" 2>&1
echo -e "" >> "response.txt"

echo "logged in!"

echo -e "setting client side cookie and making a post as alice"

echo "making a post" >> "response.txt"
curl -vs -b "cookie-jar.txt" -d "title=NEW&content=WOW IT WORKED&type=1&form=content" -X POST "$1/post.php" >> "response.txt" 2>&1
echo -e "" >> "response.txt"

echo "made a post!"

echo -e "liking the post we just made"

#curl $1 > "home.html"
#HTML="$(grep -oP 'author-[0-9]*[0-9]' 'home.html')"
#FIRSTPOST="$(echo $HTML | cut -d ' ' -f1)"
#POSTID="$(echo $FIRSTPOST | cut -d '-' -f2)"
#echo "first author: $FIRSTPOST"
#echo "number: $POSTID"

echo "upvoting a post" >> "response.txt"
curl -vs -b "cookie-jar.txt" -X GET "$1/vote.php?id=15&vote=1" >> "response.txt" 2>&1
echo -e "" >> "response.txt"

echo "liked post!"

echo -e "making comment on the same post"

echo "making a comment" >> "response.txt"
curl -vs -b "cookie-jar.txt" -d "comment=NEW&parent=15&form=comment&uid=0" -X POST "$1/post.php" >> response.txt 2>&1
echo -e "" >> "response.txt"

echo "made comment!"
